function _typeof(a){"@babel/helpers - typeof";if("function"==typeof Symbol&&"symbol"==typeof Symbol.iterator){_typeof=function(a){return typeof a}}else{_typeof=function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a}}return _typeof(a)}(function(a,b){if("function"==typeof define&&define.amd){define ("qtype_imageselect/croppie",b)}else if("object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"string"!=typeof exports.nodeName){module.exports=b()}else{a.Croppie=b()}})("undefined"!=typeof self?self:this,function(){if("function"!=typeof Promise){!function(m){function n(c,a){return function(){c.apply(a,arguments)}}function o(c){if("object"!==_typeof(this))throw new TypeError("Promises must be constructed via new");if("function"!=typeof c)throw new TypeError("not a function");this._state=null,this._value=null,this._deferreds=[],f(c,n(b,this),n(e,this))}function p(f){var a=this;return null===this._state?void this._deferreds.push(f):void h(function(){var b=a._state?f.onFulfilled:f.onRejected;if(null===b)return void(a._state?f.resolve:f.reject)(a._value);var c;try{c=b(a._value)}catch(a){return void f.reject(a)}f.resolve(c)})}function b(g){try{if(g===this)throw new TypeError("A promise cannot be resolved with itself.");if(g&&("object"===_typeof(g)||"function"==typeof g)){var a=g.then;if("function"==typeof a)return void f(n(a,g),n(b,this),n(e,this))}this._state=!0,this._value=g,d.call(this)}catch(a){e.call(this,a)}}function e(b){this._state=!1,this._value=b,d.call(this)}function d(){for(var c=0,d=this._deferreds.length;d>c;c++){p.call(this,this._deferreds[c])}this._deferreds=null}function g(e,a,b,c){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof a?a:null,this.resolve=b,this.reject=c}function f(e,f,b){var c=!1;try{e(function(b){c||(c=!0,f(b))},function(d){c||(c=!0,b(d))})}catch(a){if(c)return;c=!0,b(a)}}var c=setTimeout,h="function"==typeof setImmediate&&setImmediate||function(b){c(b,1)},i=Array.isArray||function(b){return"[object Array]"===Object.prototype.toString.call(b)};o.prototype["catch"]=function(b){return this.then(null,b)},o.prototype.then=function(d,a){var b=this;return new o(function(e,c){p.call(b,new g(d,a,e,c))})},o.all=function(){var j=Array.prototype.slice.call(1===arguments.length&&i(arguments[0])?arguments[0]:arguments);return new o(function(a,b){function c(e,f){try{if(f&&("object"===_typeof(f)||"function"==typeof f)){var g=f.then;if("function"==typeof g)return void g.call(f,function(b){c(e,b)},b)}j[e]=f,0==--d&&a(j)}catch(a){b(a)}}if(0===j.length)return a([]);for(var d=j.length,g=0;g<j.length;g++){c(g,j[g])}})},o.resolve=function(c){return c&&"object"===_typeof(c)&&c.constructor===o?c:new o(function(a){a(c)})},o.reject=function(d){return new o(function(a,b){b(d)})},o.race=function(f){return new o(function(a,b){for(var c=0,g=f.length;g>c;c++){f[c].then(a,b)}})},o._setImmediateFn=function(b){h=b},"undefined"!=typeof module&&module.exports?module.exports=o:m.Promise||(m.Promise=o)}(this)}if("undefined"!=typeof window&&"function"!=typeof window.CustomEvent){(function(){function a(a,b){b=b||{bubbles:!1,cancelable:!1,detail:void 0};var c=document.createEvent("CustomEvent");c.initCustomEvent(a,b.bubbles,b.cancelable,b.detail);return c}a.prototype=window.Event.prototype;window.CustomEvent=a})()}if("undefined"!=typeof HTMLCanvasElement&&!HTMLCanvasElement.prototype.toBlob){Object.defineProperty(HTMLCanvasElement.prototype,"toBlob",{value:function value(a,b,c){for(var d=atob(this.toDataURL(b,c).split(",")[1]),e=d.length,f=new Uint8Array(e),g=0;g<e;g++){f[g]=d.charCodeAt(g)}a(new Blob([f],{type:b||"image/png"}))}})}var S=["Webkit","Moz","ms"],T="undefined"!=typeof document?document.createElement("div").style:{},U=[1,8,3,6],V=[2,7,4,5],W,X,Y;function a(a){if(a in T){return a}var b=a[0].toUpperCase()+a.slice(1),c=S.length;while(c--){a=S[c]+b;if(a in T){return a}}}X=a("transform");W=a("transformOrigin");Y=a("userSelect");function b(a,b){var c=-1<U.indexOf(a)?U:V,d=c.indexOf(a),e=b/90%c.length;return c[(c.length+d+e%c.length)%c.length]}function c(a,b){a=a||{};for(var d in b){if(b[d]&&b[d].constructor&&b[d].constructor===Object){a[d]=a[d]||{};c(a[d],b[d])}else{a[d]=b[d]}}return a}function d(a){return c({},a)}function e(a){if("createEvent"in document){var b=document.createEvent("HTMLEvents");b.initEvent("change",!1,!0);a.dispatchEvent(b)}else{a.fireEvent("onchange")}}function f(a,b,c){if("string"==typeof b){var d=b;b={};b[d]=c}for(var e in b){a.style[e]=b[e]}}function g(a,b){if(a.classList){a.classList.add(b)}else{a.className+=" "+b}}function h(a,b){if(a.classList){a.classList.remove(b)}else{a.className=a.className.replace(b,"")}}function i(a,b){for(var c in b){a.setAttribute(c,b[c])}}function j(a){return parseInt(a,10)}function k(a,b){if(!a){throw"Source image missing"}var c=new Image;c.style.opacity="0";return new Promise(function(d,e){function f(){c.style.opacity="1";setTimeout(function(){d(c)},1)}c.removeAttribute("crossOrigin");if(a.match(/^https?:\/\/|^\/\//)){c.setAttribute("crossOrigin","anonymous")}c.onload=function(){if(b){EXIF.getData(c,function(){f()})}else{f()}};c.onerror=function(a){c.style.opacity=1;setTimeout(function(){e(a)},1)};c.src=a})}function l(a,b){var c=a.naturalWidth,d=a.naturalHeight,e=b||m(a);if(e&&5<=e){var f=c;c=d;d=f}return{width:c,height:d}}var Z={translate3d:{suffix:", 0px"},translate:{suffix:""}},_=function(a,b,c){this.x=parseFloat(a);this.y=parseFloat(b);this.scale=parseFloat(c)};_.parse=function(a){if(a.style){return _.parse(a.style[X])}else if(-1<a.indexOf("matrix")||-1<a.indexOf("none")){return _.fromMatrix(a)}else{return _.fromString(a)}};_.fromMatrix=function(a){var b=a.substring(7).split(",");if(!b.length||"none"===a){b=[1,0,0,1,0,0]}return new _(j(b[4]),j(b[5]),parseFloat(b[0]))};_.fromString=function(a){var b=a.split(") "),c=b[0].substring(R.globals.translate.length+1).split(","),d=1<b.length?b[1].substring(6):1,e=1<c.length?c[0]:0,f=1<c.length?c[1]:0;return new _(e,f,d)};_.prototype.toString=function(){var a=Z[R.globals.translate].suffix||"";return R.globals.translate+"("+this.x+"px, "+this.y+"px"+a+") scale("+this.scale+")"};var aa=function(a){if(!a||!a.style[W]){this.x=0;this.y=0;return}var b=a.style[W].split(" ");this.x=parseFloat(b[0]);this.y=parseFloat(b[1])};aa.prototype.toString=function(){return this.x+"px "+this.y+"px"};function m(a){return a.exifdata&&a.exifdata.Orientation?j(a.exifdata.Orientation):1}function n(a,b,c){var d=b.width,e=b.height,f=a.getContext("2d");a.width=b.width;a.height=b.height;f.save();switch(c){case 2:f.translate(d,0);f.scale(-1,1);break;case 3:f.translate(d,e);f.rotate(180*Math.PI/180);break;case 4:f.translate(0,e);f.scale(1,-1);break;case 5:a.width=e;a.height=d;f.rotate(90*Math.PI/180);f.scale(1,-1);break;case 6:a.width=e;a.height=d;f.rotate(90*Math.PI/180);f.translate(0,-e);break;case 7:a.width=e;a.height=d;f.rotate(-90*Math.PI/180);f.translate(-d,e);f.scale(1,-1);break;case 8:a.width=e;a.height=d;f.translate(0,d);f.rotate(-90*Math.PI/180);break;}f.drawImage(b,0,0,d,e);f.restore()}function o(){var a=this,b=a.options.viewport.type?"cr-vp-"+a.options.viewport.type:null,c,d,e,h,j,k;a.options.useCanvas=a.options.enableOrientation||p.call(a);a.data={};a.elements={};c=a.elements.boundary=document.createElement("div");e=a.elements.viewport=document.createElement("div");d=a.elements.img=document.createElement("img");h=a.elements.overlay=document.createElement("div");if(a.options.useCanvas){a.elements.canvas=document.createElement("canvas");a.elements.preview=a.elements.canvas}else{a.elements.preview=d}g(c,"cr-boundary");c.setAttribute("aria-dropeffect","none");j=a.options.boundary.width;k=a.options.boundary.height;f(c,{width:j+(isNaN(j)?"":"px"),height:k+(isNaN(k)?"":"px")});g(e,"cr-viewport");if(b){g(e,b)}f(e,{width:a.options.viewport.width+"px",height:a.options.viewport.height+"px"});e.setAttribute("tabindex",0);g(a.elements.preview,"cr-image");i(a.elements.preview,{alt:"preview","aria-grabbed":"false"});g(h,"cr-overlay");a.element.appendChild(c);c.appendChild(a.elements.preview);c.appendChild(e);c.appendChild(h);g(a.element,"croppie-container");if(a.options.customClass){g(a.element,a.options.customClass)}w.call(this);if(a.options.enableZoom){s.call(a)}if(a.options.enableResize){q.call(a)}}function p(){return this.options.enableExif&&window.EXIF}function q(){var d=this,e=document.createElement("div"),h=!1,i,j,k,l=50,m,n,o,p;g(e,"cr-resizer");f(e,{width:this.options.viewport.width+"px",height:this.options.viewport.height+"px"});if(this.options.resizeControls.height){o=document.createElement("div");g(o,"cr-resizer-vertical");e.appendChild(o)}if(this.options.resizeControls.width){p=document.createElement("div");g(p,"cr-resizer-horisontal");e.appendChild(p)}function a(a){if(a.button!==void 0&&0!==a.button)return;a.preventDefault();if(h){return}var e=d.elements.overlay.getBoundingClientRect();h=!0;j=a.pageX;k=a.pageY;i=-1!==a.currentTarget.className.indexOf("vertical")?"v":"h";m=e.width;n=e.height;if(a.touches){var f=a.touches[0];j=f.pageX;k=f.pageY}window.addEventListener("mousemove",b);window.addEventListener("touchmove",b);window.addEventListener("mouseup",c);window.addEventListener("touchend",c);document.body.style[Y]="none"}function b(a){var b=a.pageX,c=a.pageY;a.preventDefault();if(a.touches){var g=a.touches[0];b=g.pageX;c=g.pageY}var h=b-j,o=c-k,p=d.options.viewport.height+o,q=d.options.viewport.width+h;if("v"===i&&p>=l&&p<=n){f(e,{height:p+"px"});d.options.boundary.height+=o;f(d.elements.boundary,{height:d.options.boundary.height+"px"});d.options.viewport.height+=o;f(d.elements.viewport,{height:d.options.viewport.height+"px"})}else if("h"===i&&q>=l&&q<=m){f(e,{width:q+"px"});d.options.boundary.width+=h;f(d.elements.boundary,{width:d.options.boundary.width+"px"});d.options.viewport.width+=h;f(d.elements.viewport,{width:d.options.viewport.width+"px"})}x.call(d);B.call(d);v.call(d);y.call(d);k=c;j=b}function c(){h=!1;window.removeEventListener("mousemove",b);window.removeEventListener("touchmove",b);window.removeEventListener("mouseup",c);window.removeEventListener("touchend",c);document.body.style[Y]=""}if(o){o.addEventListener("mousedown",a);o.addEventListener("touchstart",a)}if(p){p.addEventListener("mousedown",a);p.addEventListener("touchstart",a)}this.elements.boundary.appendChild(e)}function r(a){if(this.options.enableZoom){var b=this.elements.zoomer,c=L(a,4);b.value=Math.max(parseFloat(b.min),Math.min(parseFloat(b.max),c)).toString()}}function s(){var c=this,d=c.elements.zoomerWrap=document.createElement("div"),e=c.elements.zoomer=document.createElement("input");g(d,"cr-slider-wrap");g(e,"cr-slider");e.type="range";e.step="0.0001";e.value="1";e.style.display=c.options.showZoomer?"":"none";e.setAttribute("aria-label","zoom");c.element.appendChild(d);d.appendChild(e);c._currentZoom=1;function a(){t.call(c,{value:parseFloat(e.value),origin:new aa(c.elements.preview),viewportRect:c.elements.viewport.getBoundingClientRect(),transform:_.parse(c.elements.preview)})}function b(b){var d,e;if("ctrl"===c.options.mouseWheelZoom&&!0!==b.ctrlKey){return 0}else if(b.wheelDelta){d=b.wheelDelta/1200}else if(b.deltaY){d=b.deltaY/1060}else if(b.detail){d=b.detail/-60}else{d=0}e=c._currentZoom+d*c._currentZoom;b.preventDefault();r.call(c,e);a.call(c)}c.elements.zoomer.addEventListener("input",a);c.elements.zoomer.addEventListener("change",a);if(c.options.mouseWheelZoom){c.elements.boundary.addEventListener("mousewheel",b);c.elements.boundary.addEventListener("DOMMouseScroll",b)}}function t(a){var c=this,d=a?a.transform:_.parse(c.elements.preview),e=a?a.viewportRect:c.elements.viewport.getBoundingClientRect(),g=a?a.origin:new aa(c.elements.preview);function b(){var a={};a[X]=d.toString();a[W]=g.toString();f(c.elements.preview,a)}c._currentZoom=a?a.value:c._currentZoom;d.scale=c._currentZoom;c.elements.zoomer.setAttribute("aria-valuenow",c._currentZoom);b();if(c.options.enforceBoundary){var h=u.call(c,e),i=h.translate,j=h.origin;if(d.x>=i.maxX){g.x=j.minX;d.x=i.maxX}if(d.x<=i.minX){g.x=j.maxX;d.x=i.minX}if(d.y>=i.maxY){g.y=j.minY;d.y=i.maxY}if(d.y<=i.minY){g.y=j.maxY;d.y=i.minY}}b();ba.call(c);y.call(c)}function u(a){var b=this,c=b._currentZoom,d=a.width,e=a.height,f=b.elements.boundary.clientWidth/2,g=b.elements.boundary.clientHeight/2,h=b.elements.preview.getBoundingClientRect(),i=h.width,j=h.height,k=d/2,l=e/2,m=-1*(k/c-f),n=-1*(l/c-g),o=1/c*k,p=1/c*l;return{translate:{maxX:m,minX:m-(i*(1/c)-d*(1/c)),maxY:n,minY:n-(j*(1/c)-e*(1/c))},origin:{maxX:i*(1/c)-o,minX:o,maxY:j*(1/c)-p,minY:p}}}function v(a){var b=this,c=b._currentZoom,d=b.elements.preview.getBoundingClientRect(),e=b.elements.viewport.getBoundingClientRect(),g=_.parse(b.elements.preview.style[X]),h=new aa(b.elements.preview),i=e.top-d.top+e.height/2,j=e.left-d.left+e.width/2,k={},l={};if(a){var m=h.x,n=h.y,o=g.x,p=g.y;k.y=m;k.x=n;g.y=o;g.x=p}else{k.y=i/c;k.x=j/c;l.y=(k.y-h.y)*(1-c);l.x=(k.x-h.x)*(1-c);g.x-=l.x;g.y-=l.y}var q={};q[W]=k.x+"px "+k.y+"px";q[X]=g.toString();f(b.elements.preview,q)}function w(){var j=this,k=!1,l,m,n,o,p;function a(a,b){var c=j.elements.preview.getBoundingClientRect(),d=p.y+b,e=p.x+a;if(j.options.enforceBoundary){if(o.top>c.top+b&&o.bottom<c.bottom+b){p.y=d}if(o.left>c.left+a&&o.right<c.right+a){p.x=e}}else{p.y=d;p.x=e}}function b(a){j.elements.preview.setAttribute("aria-grabbed",a);j.elements.boundary.setAttribute("aria-dropeffect",a?"move":"none")}function c(a){if(a.shiftKey&&(a.keyCode===38||a.keyCode===40)){var c;if(a.keyCode===38){c=parseFloat(j.elements.zoomer.value)+parseFloat(j.elements.zoomer.step)}else{c=parseFloat(j.elements.zoomer.value)-parseFloat(j.elements.zoomer.step)}j.setZoom(c)}else if(j.options.enableKeyMovement&&37<=a.keyCode&&40>=a.keyCode){a.preventDefault();var e=b(a.keyCode);p=_.parse(j.elements.preview);document.body.style[Y]="none";o=j.elements.viewport.getBoundingClientRect();d(e)}function b(a){switch(a){case 37:return[1,0];case 38:return[0,1];case 39:return[-1,0];case 40:return[0,-1];}}}function d(b){var c=b[0],d=b[1],e={};a(c,d);e[X]=p.toString();f(j.elements.preview,e);x.call(j);document.body.style[Y]="";v.call(j);y.call(j);n=0}function g(a){if(a.button!==void 0&&0!==a.button)return;a.preventDefault();if(k)return;k=!0;l=a.pageX;m=a.pageY;if(a.touches){var c=a.touches[0];l=c.pageX;m=c.pageY}b(k);p=_.parse(j.elements.preview);window.addEventListener("mousemove",h);window.addEventListener("touchmove",h);window.addEventListener("mouseup",i);window.addEventListener("touchend",i);document.body.style[Y]="none";o=j.elements.viewport.getBoundingClientRect()}function h(b){b.preventDefault();var c=b.pageX,d=b.pageY;if(b.touches){var g=b.touches[0];c=g.pageX;d=g.pageY}var h=c-l,i=d-m,k={};if("touchmove"===b.type){if(1<b.touches.length){var o=b.touches[0],q=b.touches[1],s=Math.sqrt((o.pageX-q.pageX)*(o.pageX-q.pageX)+(o.pageY-q.pageY)*(o.pageY-q.pageY));if(!n){n=s/j._currentZoom}var t=s/n;r.call(j,t);e(j.elements.zoomer);return}}a(h,i);k[X]=p.toString();f(j.elements.preview,k);x.call(j);m=d;l=c}function i(){k=!1;b(k);window.removeEventListener("mousemove",h);window.removeEventListener("touchmove",h);window.removeEventListener("mouseup",i);window.removeEventListener("touchend",i);document.body.style[Y]="";v.call(j);y.call(j);n=0}j.elements.overlay.addEventListener("mousedown",g);j.elements.viewport.addEventListener("keydown",c);j.elements.overlay.addEventListener("touchstart",g)}function x(){if(!this.elements)return;var a=this,b=a.elements.boundary.getBoundingClientRect(),c=a.elements.preview.getBoundingClientRect();f(a.elements.overlay,{width:c.width+"px",height:c.height+"px",top:c.top-b.top+"px",left:c.left-b.left+"px"})}var ba=function(a,b,c){var d;return function(){var e=this,f=arguments,g=c&&!d;clearTimeout(d);d=setTimeout(function later(){d=null;if(!c)a.apply(e,f)},b);if(g)a.apply(e,f)}}(x,500);function y(){var a=this,b=a.get();if(!z.call(a)){return}a.options.update.call(a,b);if(a.$&&"undefined"==typeof Prototype){a.$(a.element).trigger("update.croppie",b)}else{var c;if(window.CustomEvent){c=new CustomEvent("update",{detail:b})}else{c=document.createEvent("CustomEvent");c.initCustomEvent("update",!0,!0,b)}a.element.dispatchEvent(c)}}function z(){return 0<this.elements.preview.offsetHeight&&0<this.elements.preview.offsetWidth}function A(){var a=this,b={},c=a.elements.preview,d,e=new _(0,0,1),g=new aa,h=z.call(a);if(!h||a.data.bound){return}a.data.bound=!0;b[X]=e.toString();b[W]=g.toString();b.opacity=1;f(c,b);d=a.elements.preview.getBoundingClientRect();a._originalImageWidth=d.width;a._originalImageHeight=d.height;a.data.orientation=p.call(a)?m(a.elements.img):a.data.orientation;if(a.options.enableZoom){B.call(a,!0)}else{a._currentZoom=1}e.scale=a._currentZoom;b[X]=e.toString();f(c,b);if(a.data.points.length){C.call(a,a.data.points)}else{D.call(a)}v.call(a);x.call(a)}function B(a){var b=this,c=Math.max(b.options.minZoom,0)||0,d=b.options.maxZoom||1.5,f,g,h=b.elements.zoomer,i=parseFloat(h.value),j=b.elements.boundary.getBoundingClientRect(),k=l(b.elements.img,b.data.orientation),m=b.elements.viewport.getBoundingClientRect(),n,o;if(b.options.enforceBoundary){n=m.width/k.width;o=m.height/k.height;c=Math.max(n,o)}if(c>=d){d=c+1}h.min=L(c,4);h.max=L(d,4);if(!a&&(i<h.min||i>h.max)){r.call(b,i<h.min?h.min:h.max)}else if(a){g=Math.max(j.width/k.width,j.height/k.height);f=null!==b.data.boundZoom?b.data.boundZoom:g;r.call(b,f)}e(h)}function C(a){if(4!==a.length){throw"Croppie - Invalid number of points supplied: "+a}var b=this,c=a[2]-a[0],d=b.elements.viewport.getBoundingClientRect(),e=b.elements.boundary.getBoundingClientRect(),g={left:d.left-e.left,top:d.top-e.top},h=d.width/c,i=a[1],j=a[0],k=-1*a[1]+g.top,l=-1*a[0]+g.left,m={};m[W]=j+"px "+i+"px";m[X]=new _(l,k,h).toString();f(b.elements.preview,m);r.call(b,h);b._currentZoom=h}function D(){var a=this,b=a.elements.preview.getBoundingClientRect(),c=a.elements.viewport.getBoundingClientRect(),d=a.elements.boundary.getBoundingClientRect(),e=c.left-d.left,g=c.top-d.top,i=e-(b.width-c.width)/2,j=g-(b.height-c.height)/2,h=new _(i,j,a._currentZoom);f(a.elements.preview,X,h.toString())}function E(a){var b=this,c=b.elements.canvas,d=b.elements.img,e=c.getContext("2d");e.clearRect(0,0,c.width,c.height);c.width=d.width;c.height=d.height;var f=b.options.enableOrientation&&a||m(d);n(c,d,f)}function F(a){var b=this,c=a.points,d=j(c[0]),e=j(c[1]),f=j(c[2]),g=j(c[3]),h=f-d,i=g-e,k=a.circle,l=document.createElement("canvas"),m=l.getContext("2d"),n=a.outputWidth||h,o=a.outputHeight||i;l.width=n;l.height=o;if(a.backgroundColor){m.fillStyle=a.backgroundColor;m.fillRect(0,0,n,o)}var p=d,q=e,r=h,s=i,t=0,u=0,v=n,w=o;if(0>d){p=0;t=Math.abs(d)/h*n}if(r+p>b._originalImageWidth){r=b._originalImageWidth-p;v=r/h*n}if(0>e){q=0;u=Math.abs(e)/i*o}if(s+q>b._originalImageHeight){s=b._originalImageHeight-q;w=s/i*o}m.drawImage(this.elements.preview,p,q,r,s,t,u,v,w);if(k){m.fillStyle="#fff";m.globalCompositeOperation="destination-in";m.beginPath();m.arc(l.width/2,l.height/2,l.width/2,0,2*Math.PI,!0);m.closePath();m.fill()}return l}function G(a){var b=a.points,c=document.createElement("div"),d=document.createElement("img"),e=b[2]-b[0],h=b[3]-b[1];g(c,"croppie-result");c.appendChild(d);f(d,{left:-1*b[0]+"px",top:-1*b[1]+"px"});d.src=a.url;f(c,{width:e+"px",height:h+"px"});return c}function H(a){return F.call(this,a).toDataURL(a.format,a.quality)}function I(a){var b=this;return new Promise(function(c){F.call(b,a).toBlob(function(a){c(a)},a.format,a.quality)})}function J(a){if(this.elements.img.parentNode){Array.prototype.forEach.call(this.elements.img.classList,function(b){a.classList.add(b)});this.elements.img.parentNode.replaceChild(a,this.elements.img);this.elements.preview=a}this.elements.img=a}function K(a,b){var c=this,d,e=[],f=null,g=p.call(c);if("string"==typeof a){d=a;a={}}else if(Array.isArray(a)){e=a.slice()}else if("undefined"==typeof a&&c.data.url){A.call(c);y.call(c);return null}else{d=a.url;e=a.points||[];f="undefined"==typeof a.zoom?null:a.zoom}c.data.bound=!1;c.data.url=d||c.data.url;c.data.boundZoom=f;return k(d,g).then(function(d){J.call(c,d);if(!e.length){var f=l(d),g=c.elements.viewport.getBoundingClientRect(),h=g.width/g.height,i=f.width/f.height,j,k;if(i>h){k=f.height;j=k*h}else{j=f.width;k=f.height/h}var m=(f.width-j)/2,n=(f.height-k)/2,o=m+j,p=n+k;c.data.points=[m,n,o,p]}else if(c.options.relative){e=[e[0]*d.naturalWidth/100,e[1]*d.naturalHeight/100,e[2]*d.naturalWidth/100,e[3]*d.naturalHeight/100]}c.data.orientation=a.orientation||1;c.data.points=e.map(function(a){return parseFloat(a)});if(c.options.useCanvas){E.call(c,c.data.orientation)}A.call(c);y.call(c);b&&b()})}function L(a,b){return parseFloat(a).toFixed(b||0)}function M(){var a=this,b=a.elements.preview.getBoundingClientRect(),c=a.elements.viewport.getBoundingClientRect(),d=c.left-b.left,e=c.top-b.top,f=(c.width-a.elements.viewport.offsetWidth)/2,g=(c.height-a.elements.viewport.offsetHeight)/2,h=d+a.elements.viewport.offsetWidth+f,i=e+a.elements.viewport.offsetHeight+g,j=a._currentZoom;if(j===1/0||isNaN(j)){j=1}var k=a.options.enforceBoundary?0:Number.NEGATIVE_INFINITY;d=Math.max(k,d/j);e=Math.max(k,e/j);h=Math.max(k,h/j);i=Math.max(k,i/j);return{points:[L(d),L(e),L(h),L(i)],zoom:j,orientation:a.data.orientation}}var ca={type:"canvas",format:"png",quality:1},da=["jpeg","webp","png"];function N(a){var b=this,e=M.call(b),f=c(d(ca),d(a)),g="string"==typeof a?a:f.type||"base64",h=f.size||"viewport",i=f.format,j=f.quality,k=f.backgroundColor,l="boolean"==typeof f.circle?f.circle:"circle"===b.options.viewport.type,m=b.elements.viewport.getBoundingClientRect(),n=m.width/m.height,o;if("viewport"===h){e.outputWidth=m.width;e.outputHeight=m.height}else if("object"===_typeof(h)){if(h.width&&h.height){e.outputWidth=h.width;e.outputHeight=h.height}else if(h.width){e.outputWidth=h.width;e.outputHeight=h.width/n}else if(h.height){e.outputWidth=h.height*n;e.outputHeight=h.height}}if(-1<da.indexOf(i)){e.format="image/"+i;e.quality=j}e.circle=l;e.url=b.data.url;e.backgroundColor=k;o=new Promise(function(a){switch(g.toLowerCase()){case"rawcanvas":a(F.call(b,e));break;case"canvas":case"base64":a(H.call(b,e));break;case"blob":I.call(b,e).then(a);break;default:a(G.call(b,e));break;}});return o}function O(){A.call(this)}function P(a){if(!this.options.useCanvas||!this.options.enableOrientation){throw"Croppie: Cannot rotate without enableOrientation && EXIF.js included"}var c=this,d=c.elements.canvas;c.data.orientation=b(c.data.orientation,a);n(d,c.elements.img,c.data.orientation);v.call(c,!0);B.call(c);if(1==Math.abs(a)/90%2){var e=c._originalImageHeight,f=c._originalImageWidth;c._originalImageWidth=e;c._originalImageHeight=f}}function Q(){var a=this;a.element.removeChild(a.elements.boundary);h(a.element,"croppie-container");if(a.options.enableZoom){a.element.removeChild(a.elements.zoomerWrap)}delete a.elements}if("undefined"!=typeof window&&window.jQuery){var ea=window.jQuery;ea.fn.croppie=function(a){var b=_typeof(a);if("string"===b){var c=Array.prototype.slice.call(arguments,1),d=ea(this).data("croppie");if("get"===a){return d.get()}else if("result"===a){return d.result.apply(d,c)}else if("bind"===a){return d.bind.apply(d,c)}return this.each(function(){var b=ea(this).data("croppie");if(!b)return;var d=b[a];if(ea.isFunction(d)){d.apply(b,c);if("destroy"===a){ea(this).removeData("croppie")}}else{throw"Croppie "+a+" method not found"}})}else{return this.each(function(){var b=new R(this,a);b.$=ea;ea(this).data("croppie",b)})}}}function R(a,b){if(-1<a.className.indexOf("croppie-container")){throw new Error("Croppie: Can't initialize croppie more than once")}this.element=a;this.options=c(d(R.defaults),b);if("img"===this.element.tagName.toLowerCase()){var e=this.element;g(e,"cr-original-image");i(e,{"aria-hidden":"true",alt:""});var f=document.createElement("div");this.element.parentNode.appendChild(f);f.appendChild(e);this.element=f;this.options.url=this.options.url||e.src}o.call(this);if(this.options.url){var h={url:this.options.url,points:this.options.points};delete this.options.url;delete this.options.points;K.call(this,h)}}R.defaults={viewport:{width:100,height:100,type:"square"},boundary:{},orientationControls:{enabled:!0,leftClass:"",rightClass:""},resizeControls:{width:!0,height:!0},customClass:"",showZoomer:!0,enableZoom:!0,enableResize:!1,mouseWheelZoom:!0,enableExif:!1,enforceBoundary:!0,enableOrientation:!1,enableKeyMovement:!0,update:function update(){}};R.globals={translate:"translate3d"};c(R.prototype,{bind:function bind(a,b){return K.call(this,a,b)},get:function get(){var a=M.call(this),b=a.points;if(this.options.relative){b[0]/=this.elements.img.naturalWidth/100;b[1]/=this.elements.img.naturalHeight/100;b[2]/=this.elements.img.naturalWidth/100;b[3]/=this.elements.img.naturalHeight/100}return a},result:function result(a){return N.call(this,a)},refresh:function refresh(){return O.call(this)},setZoom:function setZoom(a){r.call(this,a);e(this.elements.zoomer)},rotate:function rotate(a){P.call(this,a)},destroy:function destroy(){return Q.call(this)}});return R});
//# sourceMappingURL=croppie.min.js.map
